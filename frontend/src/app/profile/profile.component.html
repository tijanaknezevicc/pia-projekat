<section>
  <div class="container py-5 h-100">
    <div class="row justify-content-center align-items-center h-100">
      <div class="col-12 col-lg-11 col-xl-10">
        <div class="card shadow-2-strong card-registration" style="border-radius: 15px;">
          <div class="card-body p-4 p-md-5">
            <h4 class="mb-4 pb-2 pb-md-0 mb-md-5">Moj profil</h4>

            <form (ngSubmit)="updateUser()" #profileForm="ngForm" enctype="multipart/form-data" novalidate>

              @if (message != '') {
              <div class="row">
                <span class="mb-4" style="color: red">{{message}}</span>
              </div>
              }

              <div class="row align-items-center">
                <div class="col-md-3 mb-4 text-center">
                  <img [src]="backendUrl + user.pfp+ '?t=' + timestamp" alt="profilna slika"
                    class="img-fluid rounded" style="width: auto; height: auto; object-fit: cover;">
                  <input type="file" id="pfp" name="pfp" class="form-control mt-3" (change)="onFileSelect($event)">
                </div>

                <div class="col-md-9 mb-4">
                  <div class="row">
                    <div class="col-md-6 mb-4">
                      <div class="form-outline mb-3">
                        <label class="form-label" for="email">
                          e-mail
                        </label>
                        <input
                          type="email"
                          id="email"
                          name="email"
                          placeholder="e-mail"
                          class="form-control form-control-lg"
                          [(ngModel)]="user.email"
                          #emailCtrl="ngModel"
                          pattern="^[\w.-]+@([\w-]+\.)+[\w-]{2,4}$"
                          required>


                        @if (emailCtrl.invalid && emailCtrl.touched) {
                        <div class="alert alert-danger">
                          @if (emailCtrl.errors?.['required']) {
                          polje je obavezno
                          }
                          @if (emailCtrl.errors?.['pattern']) {
                          email nije u ispravnom formatu
                          }
                        </div>
                        }
                      </div>
                    </div>

                    <div class="col-md-6 mb-4">
                      <div class="form-outline mb-3">
                        <label class="form-label" for="phone">
                          kontakt telefon
                        </label>
                        <input
                          type="text"
                          id="phone"
                          name="phone"
                          placeholder="kontakt telefon"
                          class="form-control form-control-lg"
                          [(ngModel)]="user.phone"
                          #phoneCtrl="ngModel"
                          required
                          pattern="^\+?\d{8,15}$">

                        @if (phoneCtrl.invalid && phoneCtrl.touched) {
                          <div class="alert alert-danger">
                            @if (phoneCtrl.errors?.['required']) { polje je obavezno }
                            @if (phoneCtrl.errors?.['pattern']) { broj telefona nije u ispravnom formatu }
                          </div>
                        }
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-4">
                      <div class="form-outline mb-3">
                        <label class="form-label" for="firstName">
                          ime
                        </label>
                        <input
                          type="text"
                          id="firstName"
                          name="firstName"
                          placeholder="ime"
                          class="form-control form-control-lg"
                          [(ngModel)]="user.firstName"
                          #firstNameCtrl="ngModel"
                          required>

                        @if (firstNameCtrl.invalid && firstNameCtrl.touched) {
                          <div class="alert alert-danger">polje je obavezno</div>
                        }
                      </div>
                    </div>

                    <div class="col-md-6 mb-4">
                      <div class="form-outline mb-3">
                        <label class="form-label" for="lastName">
                          prezime
                        </label>
                        <input
                          type="text"
                          id="lastName"
                          name="lastName"
                          placeholder="prezime"
                          class="form-control form-control-lg"
                          [(ngModel)]="user.lastName"
                          #lastNameCtrl="ngModel"
                          required>

                        @if (lastNameCtrl.invalid && lastNameCtrl.touched) {
                        <div class="alert alert-danger">polje je obavezno</div>
                        }
                      </div>
                    </div>

                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-4">
                      <div class="form-outline mb-3">
                        <label class="form-label" for="address">
                          adresa
                        </label>
                        <input
                          type="text"
                          id="address"
                          name="address"
                          placeholder="adresa"
                          class="form-control form-control-lg"
                          [(ngModel)]="user.address"
                          #addressCtrl="ngModel"
                          required>

                        @if (addressCtrl.invalid && addressCtrl.touched) {
                        <div class="alert alert-danger">polje je obavezno</div>
                        }
                      </div>
                    </div>

                    <div class="col-md-6 mb-4">
                      <label class="form-label" for="payment">broj kreditne kartice<span style="color:red">*</span></label>
                      <div class="input-group">
                        <input type="text" id="payment" name="payment" class="form-control form-control-lg"
                          [(ngModel)]="user.payment" #paymentCtrl="ngModel" (input)="formatCardNumber($event)"
                          maxlength="19" required
                          pattern="^((?:4539|4556|4916|4532|4929|4485|4716)(?: \d{4}){3}|5[1-5]\d{2}(?: \d{4}){3}|(?:30[0-3]\d|36\d{2}|38\d{2}) \d{7} \d{4})$"
                          title="Diners, MasterCard ili Visa">
                        <span class="input-group-text bg-white border-start-0">
                          <img *ngIf="cardType" [src]="cardType" alt="card logo" style="height:24px;" />
                        </span>
                      </div>
                      @if (paymentCtrl.invalid && paymentCtrl.touched) {
                      <div class="alert alert-danger">
                        @if (paymentCtrl.errors?.['required']) { polje je obavezno }
                        @if (paymentCtrl.errors?.['pattern']) { nije uneta ispravna kartica }
                      </div>
                      }
                    </div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="mt-4 pt-2">
                  <button class="btn btn-primary btn-lg" type="submit" [disabled]="!profileForm.valid">
                    a≈æuriraj profil
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
